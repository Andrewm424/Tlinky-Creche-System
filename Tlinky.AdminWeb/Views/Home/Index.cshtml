@{
    ViewData["Title"] = "Dashboard";
    var updated = DateTime.UtcNow.AddHours(2).ToString("dd MMM yyyy, HH:mm");
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

<style>
    body {
        font-family: 'Inter', sans-serif;
        background: #f8f9fb;
        margin: 0;
        padding: 0;
    }

    h2.dashboard-title {
        font-weight: 600;
        margin-bottom: 24px;
        color: #222;
    }

    .dashboard-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .metric-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
        gap: 20px;
    }

    .metric-card {
        background: #fff;
        border-radius: 18px;
        padding: 22px 24px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.06);
        transition: transform .25s ease, box-shadow .25s ease;
        position: relative;
    }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.08);
        }

        .metric-card h4 {
            margin: 0;
            font-weight: 600;
            color: #555;
        }

    .metric-value {
        font-size: 2.4rem;
        font-weight: 700;
        color: #111;
        margin-top: 8px;
    }

    .metric-icon {
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2rem;
        opacity: 0.3;
    }

    .card {
        background: #fff;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    th, td {
        padding: 10px 12px;
        border-bottom: 1px solid #eee;
    }

    th {
        background: #fafafa;
        font-weight: 600;
        color: #333;
        text-align: left;
    }

    .badge {
        padding: 5px 10px;
        border-radius: 6px;
        color: #fff;
        font-size: 0.85rem;
    }

        .badge.success {
            background: #28a745;
        }

        .badge.warn {
            background: #ffc107;
            color: #000;
        }

        .badge.danger {
            background: #dc3545;
        }

    .footer-note {
        margin-top: 24px;
        text-align: right;
        color: #777;
        font-size: 0.9rem;
    }
</style>

<div class="dashboard-container">
    <h2 class="dashboard-title">Welcome to Tlinky Dashboard</h2>

    <!-- Metric Cards -->
    <div class="metric-grid">
        <div class="metric-card">
            <i class="bi bi-people metric-icon text-primary"></i>
            <h4>Children Enrolled</h4>
            <div class="metric-value">@ViewBag.TotalChildren</div>
        </div>
        <div class="metric-card">
            <i class="bi bi-person-video3 metric-icon text-success"></i>
            <h4>Teachers</h4>
            <div class="metric-value">@ViewBag.TotalTeachers</div>
        </div>
        <div class="metric-card">
            <i class="bi bi-house-heart metric-icon text-warning"></i>
            <h4>Parents</h4>
            <div class="metric-value">@ViewBag.TotalParents</div>
        </div>
        <div class="metric-card">
            <i class="bi bi-cash-stack metric-icon text-success"></i>
            <h4>Fees Collected</h4>
            <div class="metric-value">R @String.Format("{0:N0}", ViewBag.TotalCollected)</div>
        </div>
        <div class="metric-card">
            <i class="bi bi-wallet2 metric-icon text-danger"></i>
            <h4>Outstanding Fees</h4>
            <div class="metric-value">R @String.Format("{0:N0}", ViewBag.OutstandingFees)</div>
        </div>
        <div class="metric-card">
            <i class="bi bi-exclamation-triangle metric-icon text-danger"></i>
            <h4>Incidents Logged</h4>
            <div class="metric-value">@ViewBag.TotalIncidents</div>
        </div>
        <div class="metric-card">
            <i class="bi bi-calendar-check metric-icon text-info"></i>
            <h4>Present Today</h4>
            <div class="metric-value">@ViewBag.PresentToday</div>
        </div>
    </div>

    <!-- Attendance Table -->
    <div class="card" style="margin-top:28px;">
        <h4>Today’s Attendance</h4>
        <table>
            <thead>
                <tr><th>Name</th><th>Class</th><th>Status</th></tr>
            </thead>
            <tbody>
                @if (ViewBag.TodaysAttendance == null || !((IEnumerable<dynamic>)ViewBag.TodaysAttendance).Any())
                {
                    <tr><td colspan="3" class="text-center">No attendance records for today.</td></tr>
                }
                else
                {
                    foreach (var rec in ViewBag.TodaysAttendance)
                    {
                        var badge = rec.Status == "Present" ? "success" :
                        rec.Status == "Late" ? "warn" : "danger";
                        <tr>
                            <td>@rec.ChildName</td>
                            <td>@rec.ClassName</td>
                            <td><span class="badge @badge">@rec.Status</span></td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="footer-note">
        Last updated: @updated (South Africa Standard Time)
    </div>
</div>
